# Telegram Clicker Game Mini App

Полноценная игра-кликер для Telegram Mini App с сохранением данных пользователей, админ-панелью, заданиями, реферальной системой и таблицами лидеров.

## Возможности

- ✅ **Главный экран игры** - Кликабельная монета с отслеживанием баланса
- ✅ **Система улучшений** - Пассивный доход и улучшение силы клика
- ✅ **Раздел заданий** - Подписка на каналы для получения наград
- ✅ **Реферальная система** - Приглашайте друзей и зарабатывайте монеты
- ✅ **Промокоды** - Активируйте коды для получения наград
- ✅ **Таблицы лидеров** - Топ игроков по балансу и рефералам
- ✅ **Админ-панель** - Управление заданиями и промокодами
- ✅ **Офлайн заработок** - Зарабатывайте монеты офлайн (до 24 часов)
- ✅ **Интеграция с Telegram** - Полная интеграция с WebApp API

## Технологии

**Frontend:**
- HTML, CSS, JavaScript
- Telegram WebApp API

**Backend:**
- Node.js с Express.js
- MongoDB с Mongoose
- Axios для работы с Telegram Bot API

## Установка

### Требования

- Node.js (версия 14 или выше)
- MongoDB (локальная или облачная)
- Токен Telegram бота (от @BotFather)

### Шаги установки

1. **Клонируйте или скачайте проект**

2. **Установите зависимости:**
```bash
npm install
```

3. **Настройте переменные окружения:**

Отредактируйте файл `.env` с вашими реальными значениями:

```env
# Настройки MongoDB
MONGODB_URI=mongodb://localhost:27017/telegram-clicker-game

# Настройки сервера
PORT=3000
NODE_ENV=production

# Настройки Telegram бота
BOT_TOKEN=ваш_токен_бота
BOT_USERNAME=имя_вашего_бота

# ID админов (через запятую)
ADMIN_IDS=123456789,987654321

# Награда за реферала (в монетах)
REFERRAL_REWARD=1000000
```

4. **Запустите MongoDB:**

Убедитесь, что MongoDB запущен на вашей системе или используйте облачный сервис, например MongoDB Atlas.

5. **Запустите сервер:**

```bash
# Режим разработки (с автоперезагрузкой)
npm run dev

# Продакшн режим
npm start
```

Сервер запустится на `http://localhost:3000`

## Настройка Telegram бота

### 1. Создание бота

1. Откройте Telegram и найдите @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните токен бота (он понадобится для `.env`)

### 2. Настройка Mini App

1. В BotFather используйте `/mybots`
2. Выберите вашего бота
3. Перейдите в "Bot Settings" → "Menu Button"
4. Настройте Web App URL: `https://вашдомен.com` (или URL развертывания)

### 3. Получение вашего Telegram ID

Чтобы добавить себя как админа:
1. Отправьте `/start` боту @userinfobot в Telegram
2. Скопируйте ваш ID
3. Добавьте его в `ADMIN_IDS` в файле `.env`

## Развертывание

### Развертывание в продакшн

1. **Получите домен и хостинг** (Vercel, Railway, Heroku и т.д.)

2. **Настройте MongoDB** (рекомендуется MongoDB Atlas)

3. **Настройте переменные окружения** на платформе хостинга

4. **Обновите настройки бота:**
   - Обновите Menu Button URL в BotFather
   - Убедитесь, что включен HTTPS

5. **Разверните:**
```bash
git push # или используйте команду развертывания вашей платформы
```

## API Endpoints

### Игровые эндпоинты (`/api/game`)

- `POST /init` - Инициализация или получение данных пользователя
- `POST /click` - Регистрация клика по монете
- `POST /upgrades/passive` - Получить пассивные улучшения
- `POST /upgrades/click` - Получить улучшения клика
- `POST /upgrades/passive/buy` - Купить пассивное улучшение
- `POST /upgrades/click/buy` - Купить улучшение клика
- `GET /leaderboard/balance` - Получить таблицу лидеров по балансу
- `GET /leaderboard/referrals` - Получить таблицу лидеров по рефералам
- `POST /tasks` - Получить доступные задания
- `POST /tasks/check` - Проверить выполнение задания
- `POST /promo/activate` - Активировать промокод

### Админ эндпоинты (`/api/admin`)

Все админ эндпоинты требуют аутентификации админа (Telegram ID в `ADMIN_IDS`):

- `POST /tasks` - Получить все задания
- `POST /tasks/create` - Создать новое задание
- `POST /tasks/update` - Обновить задание
- `POST /tasks/delete` - Удалить задание
- `POST /promo` - Получить все промокоды
- `POST /promo/create` - Создать промокод
- `POST /promo/update` - Обновить промокод
- `POST /promo/delete` - Удалить промокод
- `POST /stats` - Получить статистику игры

## Использование админ-панели

### Создание заданий

Задания требуют от пользователей подписки на Telegram канал. Для создания задания:

1. Получите ID канала (используйте @getidsbot в вашем канале)
2. Используйте админ API для создания задания:

```javascript
POST /api/admin/tasks/create
{
  "telegramId": "ваш_админ_id",
  "title": "Подпишитесь на наш канал",
  "description": "Получите 10,000 монет",
  "channelLink": "https://t.me/вашканал",
  "channelId": "@вашканал",
  "reward": 10000
}
```

### Создание промокодов

```javascript
POST /api/admin/promo/create
{
  "telegramId": "ваш_админ_id",
  "code": "WELCOME2024",
  "reward": 50000,
  "maxUses": 100,
  "expiresAt": "2024-12-31T23:59:59Z"
}
```

## Модели базы данных

### User (Пользователь)
- Telegram ID, имя пользователя
- Баланс, сила клика, доход в секунду
- Пассивные улучшения и улучшения клика
- Выполненные задания
- Активированные промокоды
- Реферальные данные
- Статус админа

### Task (Задание)
- Название, описание
- Ссылка и ID канала
- Размер награды
- Статус активности

### PromoCode (Промокод)
- Код (уникальный, в верхнем регистре)
- Размер награды
- Макс. использований, текущие использования
- Дата истечения
- Статус активности

## Система улучшений

### Пассивные улучшения
Автоматически генерируют монеты в секунду:
1. Кликер - 0.1/сек (15 монет)
2. Майнер - 1/сек (100 монет)
3. Ферма - 8/сек (1,100 монет)
4. Банк - 47/сек (12,000 монет)
5. Дата-центр - 260/сек (130,000 монет)
6. Космический спутник - 1,400/сек (1.4M монет)
7. Планета - 7,800/сек (20M монет)
8. Галактика - 44,000/сек (330M монет)

### Улучшения клика
Увеличивают монеты за клик:
1. Крепкий палец - +1 за клик (50 монет)
2. Турбо палец - +5 за клик (500 монет)
3. Мега удар - +25 за клик (5,000 монет)
4. Супер сила - +100 за клик (50,000 монет)
5. Божественный клик - +500 за клик (500,000 монет)
6. Космическая мощь - +2,500 за клик (5M монет)

Цены увеличиваются на 15% (пассивные) или 50% (клик) с каждой покупкой.

## Структура файлов

```
├── models/
│   ├── User.js          # Модель пользователя
│   ├── Task.js          # Модель задания
│   └── PromoCode.js     # Модель промокода
├── routes/
│   ├── game.js          # Игровые API endpoints
│   └── admin.js         # Админ API endpoints
├── config/
│   └── upgrades.js      # Конфигурация улучшений
├── server.js            # Настройка Express сервера
├── game-client.js       # Клиентская логика игры
├── index.html           # Главный интерфейс игры
├── main_coin_1.png      # Изображение монеты
├── package.json         # Зависимости
├── .env                 # Переменные окружения
└── README.md            # Этот файл
```

## Решение проблем

### Проблемы с подключением MongoDB
- Убедитесь, что MongoDB запущен
- Проверьте MONGODB_URI в `.env`
- Для MongoDB Atlas добавьте ваш IP в белый список

### Бот не работает
- Проверьте правильность BOT_TOKEN
- Убедитесь, что имя бота совпадает с BOT_USERNAME
- Убедитесь, что Web App URL установлен в BotFather

### Задания не проверяются
- ID канала должен быть точным (используйте @getidsbot)
- Бот должен быть админом канала
- В режиме разработки задания автоматически выполняются для тестирования

### Доступ админа запрещен
- Проверьте, что ваш Telegram ID в ADMIN_IDS
- ID должны быть разделены запятыми без пробелов
- Перезапустите сервер после изменения `.env`

## Разработка

### Локальное тестирование

1. Используйте ngrok для публикации локального сервера:
```bash
ngrok http 3000
```

2. Обновите Web App URL бота в BotFather с URL от ngrok

3. Тестируйте в Telegram

### Режим отладки

Игра включает логирование в консоль. Проверьте инструменты разработчика браузера для отладки.

## Примечания по безопасности

- Никогда не коммитьте файл `.env`
- Держите BOT_TOKEN в секрете
- Используйте HTTPS в продакшн
- Валидируйте все пользовательские данные на бэкенде
- Реализуйте ограничение частоты запросов для продакшн

## Лицензия

MIT License - свободно изменяйте и используйте для своих проектов!

## Поддержка

При возникновении проблем или вопросов:
1. Проверьте этот README
2. Просмотрите логи ошибок в консоли
3. Проверьте переменные окружения
4. Протестируйте API endpoints по отдельности

## Авторы

Создано с ❤️ для платформы Telegram Mini Apps


Пуш проекта: 
Репозиторий https://github.com/miloserdow-artem/telegram-clicker-game.git
в терминале на сервере:
git pull origin main
pm2 restart telegram-clicker-game